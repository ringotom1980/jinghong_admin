/*
 * Path: Public/assets/css/motion.css
 * 說明: 全站動畫規則（Toast / Modal / Dropdown / 進場淡入）
 * - 目標：簡約、乾淨、有質感；避免過度晃動
 * - 支援 prefers-reduced-motion
 *
 * ✅ FIX（2026-01-17）：
 * - 若把 .page-enter 掛在 <body> 上，body 會有 transform → 會讓 position:fixed（Modal/Toast）定位失效（跑到很下面）
 * - 解法：body.page-enter 只做淡入（不做 transform）；非 body 的 .page-enter 仍保留位移進場
 */

/* ===== Timing tokens ===== */
:root{
  --m-ease-out: cubic-bezier(.2, .9, .2, 1);
  --m-ease: cubic-bezier(.2, .8, .2, 1);
  --m-fast: 140ms;
  --m-mid: 200ms;
  --m-slow: 260ms;

  --m-blur: 10px;
}

/* ===== Base motion utilities ===== */
.motion-fade{
  opacity: 0;
  transform: translateY(2px);
  transition: opacity var(--m-mid) var(--m-ease), transform var(--m-mid) var(--m-ease);
}
.motion-fade.is-show{ opacity: 1; transform: translateY(0); }

.motion-slide-up{
  opacity: 0;
  transform: translateY(10px);
  transition: opacity var(--m-mid) var(--m-ease), transform var(--m-mid) var(--m-ease);
}
.motion-slide-up.is-show{ opacity: 1; transform: translateY(0); }

.motion-scale{
  opacity: 0;
  transform: translateY(6px) scale(.985);
  transition: opacity var(--m-mid) var(--m-ease-out), transform var(--m-mid) var(--m-ease-out);
}
.motion-scale.is-show{ opacity: 1; transform: translateY(0) scale(1); }

/* ===== Subtle hover micro-interactions ===== */
.motion-hover{
  transition: transform var(--m-fast) var(--m-ease), filter var(--m-fast) var(--m-ease);
}
.motion-hover:hover{ transform: translateY(-1px); }
.motion-hover:active{ transform: translateY(0); }

/* ===== Toast animations ===== */
/* 注意：z-index 不在 motion.css 控制，避免蓋掉 ui_toast.css 的層級 */
.toast-wrap{
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: var(--toast-z, 2147483647);
  display: grid;
  gap: 10px;
  pointer-events: none;
}

.toast{
  pointer-events: auto;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity var(--m-mid) var(--m-ease), transform var(--m-mid) var(--m-ease);
}

.toast.is-show{ opacity: 1; transform: translateY(0); }
.toast.is-leave{ opacity: 0; transform: translateY(6px); }

/* ===== Modal animations ===== */
.modal-backdrop{
  opacity: 0;
  visibility: hidden;
  transition: opacity var(--m-mid) var(--m-ease), visibility var(--m-mid) var(--m-ease);
}
.modal-backdrop.is-open{ opacity: 1; visibility: visible; }

.modal-panel{
  opacity: 0;
  transform: translateY(14px) scale(.985);
  transition: opacity var(--m-mid) var(--m-ease-out), transform var(--m-mid) var(--m-ease-out);
}

.modal-backdrop.is-open .modal-panel{
  opacity: 1;
  transform: translateY(0) scale(1);
}

.modal-backdrop.is-leave{ opacity: 0; }

/* ===== Dropdown/Menu animations ===== */
.dropdown-menu{
  opacity: 0;
  transform: translateY(-6px);
  visibility: hidden;
  transition: opacity var(--m-fast) var(--m-ease), transform var(--m-fast) var(--m-ease), visibility var(--m-fast) var(--m-ease);
}
.dropdown.is-open .dropdown-menu{
  opacity: 1;
  transform: translateY(0);
  visibility: visible;
}

/* ===== Page enter ===== */
/* ✅ 若 page-enter 掛在 body：只淡入（避免 body transform 破壞 fixed） */
body.page-enter{
  opacity: 0;
  animation: pageEnterFade var(--m-slow) var(--m-ease-out) forwards;
}

/* ✅ 若 page-enter 掛在其他容器：保留位移進場 */
.page-enter:not(body){
  opacity: 0;
  transform: translateY(6px);
  animation: pageEnterMove var(--m-slow) var(--m-ease-out) forwards;
}

@keyframes pageEnterFade{
  from { opacity: 0; }
  to   { opacity: 1; }
}

@keyframes pageEnterMove{
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ===== Reduced motion ===== */
@media (prefers-reduced-motion: reduce){
  :root{
    --m-fast: 1ms;
    --m-mid: 1ms;
    --m-slow: 1ms;
  }

  /* ✅ 無動態：body / 非 body 都不要動畫與 transform */
  body.page-enter,
  .page-enter:not(body){
    animation: none;
    opacity: 1;
    transform: none;
  }

  .motion-fade, .motion-slide-up, .motion-scale,
  .toast, .modal-panel, .dropdown-menu{
    transition: none !important;
    transform: none !important;
  }
}
